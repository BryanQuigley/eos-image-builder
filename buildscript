# -*- mode: Shell-script; sh-basic-offset: 2; indent-tabs-mode: nil -*-
# Run the eib_error stage on errors. Return code 2 is used for image
# build failures to differentiate from locking failures.
stage_error() {
  eib_error
  exit 2
}
trap stage_error ERR

# Check if build needed and return early if not
if eib_check_update && [ -z "${EIB_FORCE}" ]; then
  return 0
fi

# Real build stages
eib_ostree
eib_image
