# Default configuration for Endless image builds

[buildroot]
# Directories to mount in the buildroot
mounts_add_default = /sys
                     /proc
                     /dev
                     /dev/pts
                     ${sysconfdir}
                     ${cachedir}
                     ${srcdir}

# Debian package repository setup for the buildroot
repo =  http://obs-master.endlessm-sf.com:82/shared/eos
arch = ${build:arch}
codename = ${branch}
components = core endless

# Script to use for debootstrap
script = ${datadir}/debootstrap.script

# Packages to install in the debootstrap buildroot
packages_add_default = attr
                       awscli
                       ca-certificates
                       coreutils
                       cpio
                       dbus-user-session
                       eos-keyring
                       flatpak
                       gir1.2-flatpak-1.0
                       gir1.2-glib-2.0
                       gir1.2-ostree-1.0
                       git
                       gnupg
                       json-glib-tools
                       mount
                       openssh-client
                       ostree
                       pigz
                       python
                       python3
                       python3-apt
                       python3-gi
                       rsync
                       udev
                       util-linux
                       unzip
                       wget
                       xz-utils

# Apt archive cache directory
aptcache_dir = ${contentdir}/archives

# Apt archive cache maximum size in bytes (default 2 GB)
aptcache_max_size = 2147483648

[check]
# Merged customization hooks to run.
hooks_add_default = 50-config
                    50-media
                    50-ostree-commit

[content]
# Merged customization hooks to run.
hooks_add_default = 50-codecs-extra
                    50-flatpak
                    50-media
                    50-gnome-software-cache

[image]
# Merged customization hooks to run.
hooks_add_default = 40-flatpak-setup.chroot
                    50-branding-background
                    50-branding-control-center
                    50-branding-desktop
                    50-branding-fbe
                    50-flatpak.chroot
                    50-language
                    50-media
                    50-timezone
                    50-update-done-stamp
                    50-reclaim-swap-stamp
                    50-readahead
                    50-gnome-software-cache
                    50-eos-dir-mode-700
                    60-dconf-prepare
                    60-flatpak-autoinstall-counters.chroot
                    61-dconf-compile.chroot
                    63-icon-grid
                    70-flatpak-manifest
                    70-ostree-manifest
                    80-ldconfig-aux-cache.chroot

# Gzip compression by default (valid choices: gz or xz)
compression = gz

# Whether the root filesystem should be resized on first boot or not
rootfs_resize = true

# Don't create split images by default, as this is only used
# with specific Endless devices
split = false

# Split disk image sizes in bytes. By default, disk1 and disk2 are 16 GB
# (16 * 10**9, not 16 * 2**30). Single disk images are currently made to
# whatever size the content dictates.
disk1_size = 16000000000
disk2_size = 16000000000

# Create boot.zip by default
boot_zip = true

# Don't build ISOs by default
iso = false

# Don't reorder data by default
reorder = false

# GPG private key ID for signing images. If this is left blank, detached
# signatures will not be created.
signing_keyid = 587A279C

# Image uploading
host_short = images
host = ${host_short}.endlessm.com
user = uploader
path = /srv/images/www/nightly
destdir = ${path}/${product}-${arch}-${platform}/${branch}/${personality}/${build_version}

# Image downloading
url_root = http://${host}
url = ${url_root}/nightly/${product}-${arch}-${platform}/${branch}/${personality}/${build_version}

# Add sample media in /var/endless-content. There are only a handful of
# actual media collections. Many images simply use the en collection
# with symlinks on the server, but that can also be set in a personality
# specific override of sample_media_collection. See
# https://phabricator.endlessm.com/w/desktop/images/#sample-media.
sample_media_host = image-content.endlessm.com
sample_media_user = uploader
sample_media_arch = ${arch}
sample_media_collection = ${personality}
sample_media_path = content/sample-media/${sample_media_arch}/${sample_media_collection}

# Add preloaded content in /var/lib/kalite
# Disabled for now until we have permission to ship Khan Academy content
kalite_content = false
kalite_content_host = image-content.endlessm.com
kalite_content_user = uploader
kalite_content_path = content/kalite

# Product name for ISO labels, etc
product_name = Endless OS

# Default language (locale)
language =

# Default timezone
timezone =

# dconf overrides. Each of the elements of this list should be a keyfile in the
# format explained at https://wiki.gnome.org/Projects/dconf/SystemAdministrators
settings_add_default =

# dconf keys to lock
settings_locks_add_default =

# Hostname, to be used from the IMAGE hook 50-hostname.
# It might override values set by the OSTree builder.
hostname =

# URL for a remote KALite server (e.g., "http://teacher.local:8008")
# to be used from the IMAGE hook 50-virtualschool
kalite_server =

# Base URL to download chrome plugins from, to be used from the IMAGE hook
# 50-chrome-plugins-updater-url. It might override values set by the OSTree builder.
chrome_plugins_base_URL =

# Default partition table
partition_table = gpt

# Desktop icon grid overrides
icon_grid_add_defaults =

# Brand-specific configuration and assets for the Control Center
branding_control_center_config =
branding_control_center_logo =

# Brand-specific configuration and assets for the Desktop
branding_desktop_config =
branding_desktop_logo =

# Brand-specific configuration and assets for the First Boot Experience
branding_fbe_config =
branding_fbe_logo =

# PAYG-specific configuration
payg_customer_support_ini =

[split]
# Merged customization hooks to run.
# For now, omit the upstream content (gnome runtime) to fit on SD card.
hooks_add_default = 20-flatpak-prep-disk2
                    30-flatpak-clean-disk1.chroot
                    50-eos-setup-flatpak-extension-dir-extra.chroot
                    50-flatpak.chroot
                    70-flatpak-manifest

[ostree]
# Repository setup. By default the eos-${arch} repo and eos OS name are
# used.
product = ${build:product}
branch = ${build:branch}
ref = os/${product}/${platform}/${branch}
repo = eos-${arch}
os = eos
remote = eos

# Multiple stable minor version branches may be in use, but the deployed
# ostree configuration should use only the major version. E.g., the real
# branch may be eos2.2, but the deployed configuration should use eos2.
stable_branch = ${series}
ref_deploy = os/${product}/${platform}/${stable_branch}

# Builder directories
repodir = ${cachedir}/ostree/${repo}
checkout = ${build:tmpdir}/ostree-co

# The ostree URL that the final system will query for updates. Not used
# during build time.
url_root = https://ostree.endlessm.com
url_base = ${url_root}/ostree
url = ${url_base}/${repo}

# Development ostree repo URL root. The OS and apps are pulled from here
# during the build.
dev_url_root = https://endless:***REMOVED***@origin.ostree.endlessm.com/staging/dev

# Internal ostree server URL. This is used to pull the most recent
# commit.
int_url = ${dev_url_root}/${repo}

# Enable P2P OS updates
enable_p2p_updates = false

[manifest]
# Merged customization hooks to run.
hooks_add_default =

[publish]
# Merged customization hooks to run.
hooks_add_default = 30-start-publishing
                    40-build-log
                    50-publish
                    60-end-publishing
                    90-email-success

[error]
# Merged customization hooks to run.
hooks_add_default = 50-fail-publishing

[email]
# Success email settings
from = image-builder@endlessm.com
replyto = endless-dev@endlessm.com
to = endless-dev-status@endlessm.com

# SMTP settings
#   host - SMTP server hostname (default: localhost)
#   port - SMTP server port (default: 0, which means standard ports)
#   ssl  - Encrypt SMTP connection with SSL changing the default port
#          from 25 to 465 (default: false)
#   user - SMTP authentication user (default: not set)
#   pass - SMTP authentication password (default: not set)
host = localhost
port = 0
ssl = false
user =
pass =

[flatpak]
# Switch to allow disabling flatpak on some products
enable = true

# Flatpak architecture. This is different from debian style arch used
# for the build. E.g, the build uses amd64 while flatpak uses x86_64.
arch = ${deb_host_gnu_cpu}

# Locales to use when pulling runtimes
locales_add_default = ar bn en es fr id pt th vi zh
locales_del_default =

# Enable P2P app updates
enable_p2p_updates = true

# Flatpak installation configuration
#
# Each flatpak-remote-<name> section corresponds to a Flatpak remote.
# The string used for <name> becomes the remote name. The following
# options are supported:
#
# url - The remote URL to install flatpaks from
# apps - List of Flatpak apps required for installation.
# runtimes - List of Flatpak runtimes required for installation.
# nosplit_apps - List of Flatpak apps pruned from split images.
# nosplit_runtimes - List of Flatpak runtimes pruned from split images.
# title (optional) - A title for the remote.
# default_branch (optional) - The default branch to use for installs.
#   This affects installs during the image build as well as at runtime.
#   Flatpaks that do not specify a branch will use this by default.
#
# Additionally, a URL or path for a flatpakrepo file can be specified in
# the repo_file option. The Url, Title, DefaultBranch and GPGKey keys
# are supported within that file. See flatpak-flatpakrepo(5) for
# details. This is also the only way that a remote-specific GPG key (not
# needed for Endless repos) can be specified. Note that the above config
# options take precedence over associated keys in the flatpakrepo file.
#
# The apps, runtimes, nosplit_apps and nosplit_runtimes options are all
# merged, so they support the typical _add_/_del_ scheme. For instance,
# apps_add_default and runtimes_del_product.
[flatpak-remote-eos-apps]
url = ${ostree:url_root}/ostree/eos-apps
default_branch = ${series}
apps_add_default =
  com.endlessm.finance
  com.endlessm.programming
  com.endlessm.resume
  com.endlessm.translation
  com.github.Slingshot
  de.billardgl.Billardgl
  io.github.Supertux
  net.blockout.Blockout2
  net.gcompris.Gcompris
  net.olofson.Kobodeluxe
  net.sourceforge.Atanks
  net.sourceforge.Audacity
  net.sourceforge.Btanks
  net.sourceforge.ChromiumBSU
  net.sourceforge.Extremetuxracer
  net.sourceforge.Rili
  net.sourceforge.Supertuxkart
  net.sourceforge.Torcs
  net.sourceforge.Tuxfootball
  net.sourceforge.Warmux
  net.wz2100.Warzone2100
  org.armagetronad.Armagetronad
  org.debian.alioth.tux4kids.Tuxmath
  org.debian.alioth.tux4kids.Tuxtype
  org.debian.Tuxpuck
  org.frozenbubble.FrozenBubble
  org.gimp.Gimp
  org.gnome.Freecell
  org.gnome.Iagno
  org.gnome.people.dscorgie.Labyrinth
  org.gnome.Quadrapassel
  org.gnome.Solitaire
  org.gnome.Tetravex
  org.kde.Kalzium
  org.kde.Kapman
  org.kde.Katomic
  org.kde.Kblocks
  org.kde.Kbounce
  org.kde.Kbruch
  org.kde.Kdiamond
  org.kde.Kgeography
  org.kde.Kgoldrunner
  org.kde.Khangman
  org.kde.Kigo
  org.kde.Killbots
  org.kde.Kjumpingcube
  org.kde.Klines
  org.kde.Knavalbattle
  org.kde.Knetwalk
  org.kde.Ksame
  org.kde.Ksquares
  org.kde.Ksudoku
  org.kde.Ktuberling
  org.kde.Kubrick
  org.kde.Kwordquiz
  org.kde.Palapeli
  org.maemo.Numptyphysics
  org.marsshooter.Marsshooter
  org.openarena.Openarena
  org.openscad.Openscad
  org.seul.Pingus
  org.squeakland.Etoys
  org.squeakland.Scratch
  org.stellarium.Stellarium
  org.sugarlabs.Turtleblocks
  org.tuxfamily.Xmoto

[flatpak-remote-eos-runtimes]
url = ${ostree:url_root}/ostree/eos-${arch}

[flatpak-remote-eos-sdk]
url = ${ostree:url_root}/ostree/eos-sdk
default_branch = stable
apps_add_mandatory =
  com.endlessm.CompanionAppService
  com.endlessm.EknServicesMultiplexer
runtimes_add_default =
  org.freedesktop.Platform.Icontheme.EndlessOS//1.0

[flatpak-remote-flathub]
repo_file = https://dl.flathub.org/repo/flathub.flatpakrepo
apps_add_mandatory =
  org.libreoffice.LibreOffice
apps_add_default =
  com.endlessm.photos
  com.teeworlds.Teeworlds
  net.minetest.Minetest
  org.freeciv.Freeciv
  org.gnome.Genius
  org.gnome.Gnote
  org.gnome.Weather
  org.inkscape.Inkscape
  org.megaglest.MegaGlest
  org.pitivi.Pitivi
  org.tuxpaint.Tuxpaint
  org.wesnoth.Wesnoth

# Convenience variable primarily for other configurations to add or
# delete runtimes from the default set
freedesktop_default_branch = 1.6
runtimes_add_default =
  org.freedesktop.Platform//${freedesktop_default_branch}

# List of IDs (apps, runtimes or extensions) to never install
exclude_add_default =
  com.github.JannikHv.Gydl
  com.github.needleandthread.vocal
  com.obsproject.Studio
  com.spotify.Client
  com.uploadedlobster.peek
  com.vinszent.GnomeTwitch
  de.haeckerfelix.gradio
  io.github.GnomeMpv
  io.github.jliljebl.Flowblade
  net.mediaarea.QCTools
  org.audacityteam.Audacity
  org.blender.Blender
  org.freedesktop.Platform.ffmpeg
  org.kde.kdenlive
  org.pitivi.Pitivi.Codecs
  org.telegram.desktop
  org.tordini.flavio.Minitube
  org.videolan.VLC

# Remove Pitivi from split images temporarily, as it's the only
# remaning default GNOME 3.24 app
nosplit_add_default =
  org.pitivi.Pitivi
