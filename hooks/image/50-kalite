# Put KA Lite's content in the right place and write default config

kalitehome=${OSTREE_VAR}/lib/kalite
preloaded=${kalitehome}/PRELOADED

# Skip if the kalite helper is not installed
if ! test -f ${OSTREE_DEPLOYMENT}/lib/systemd/system/eos-kalite-systemd-helper.socket; then
    exit 0
fi

rm -rf ${kalitehome}/*
mkdir -p ${preloaded}
cp -r ${EIB_CONTENTDIR}/kalite/* ${preloaded}

# set content permissions
chown -R $(ostree_uid kalite):$(ostree_gid kalite) ${preloaded}
find ${preloaded} -type f -exec chmod 664 '{}' ';'
chmod 775 ${preloaded}

lang=$(echo ${EIB_IMAGE_LANGUAGE} | sed s/'.utf8'/''/ | sed s/'_'/'-'/)
cat <<EOF > ${kalitehome}/settings.py
# This is the default location where the kalite command finds its settings
# You can change the below lines to use different default settings or
# you can run kalite <command> --settings=other_module

from kalite.project.settings.base import *

# from kalite.project.settings.dev import *
# from kalite.project.settings.raspberry_pi import *

LANGUAGE_CODE="${lang}"
EOF
